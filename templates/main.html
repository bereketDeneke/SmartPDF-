<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan2 PDF+</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="static/src/app.css">
    <link rel="shortcut icon" href="static/assets/smart PDF logo.png">
    <script src="static/src/app.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
          <a class="navbar-brand" href="#">
            <img src="static/assets/smart PDF logo.png" height="90px" alt="SmartPDF Logo">
            <!-- <span style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-weight: bold;">SmartPDF</span> -->
          </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <a class="nav-link" href="#">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Features</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">About</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Contact</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      
      <div class="page-wrapper d-flex flex-column" id="wrapper">
        <!-- Main content -->
        <main class="flex-grow-1">
          <div class="container py-5"  id="container">
          <!-- Get started part -->
            <div class="card container" style="width:max-content !important;" >
                <div class="card-header">
                  <div class="card-title">
                    <h1>Get started</h1>
                  </div>
                </div>
                <div class="card-body">
                  <form action="#" enctype="multipart/form-data">
                    <div class="row text-center">
                      <select name="lang" class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
                        <option value="" disabled selected>Select a language</option>
                        <option value="arabic">Arabic <i class="fas fa-flag"></i></option>
                        <option value="amharic">Amharic <i class="fas fa-flag"></i></option>
                        <option value="english">English <i class="fas fa-flag"></i></option>
                        <option value="spanish">Spanish <i class="fas fa-flag"></i></option>
                      </select>
        
                      <select class="form-select form-select-lg mb-3" name="request_type" aria-label=".form-select-lg example">
                        <option value="" disabled selected>Request type</option>
                        <option value="summary">Summary <i class="fas fa-flag"></i></option>
                        <option value="transcription">Transcription <i class="fas fa-flag"></i></option>
                      </select>

                      <div class="form-group d-flex flex-row align-items-center  mb-3">
                        <label for="number-input" class="mr-3">Summary Word Limit: </label>
                        <div class="flex-grow-1">
                          <input type="number" id="number-input" name="word_limit" class="form-control" min="30" max="700" value="100">
                        </div>
                      </div>                  
                      
                      <div class="mb-3">
                        <input name="file" class="form-control" type="file" id="formFile">
                      </div>
                      
                      <div class="form-group">
                          <input type="button" id="submit" class="form-group btn btn-primary" value="Process">
                      </div>
                    </div>
                  </form>
                </div>
            </div>
            <div class="container">
                Summary: <div id="response" style="text-align: justify;"></div>
            </div>
          </div>
        </main>
        <!-- Footer -->
        <footer class="bg-dark text-light py-3 fixed-bottom" style="position:sticky">
          <div class="container">
            <div class="row">
              <div class="col-md-4">
                <h5>About</h5>
                <p>Scan2 PDF+ converts scanned PDFs into selectable PDFs with OCR technology.</p>
              </div>
              <div class="col-md-4">
                <h5>Contact</h5>
                <p>Email: info@scan2pdfplus.com<br>Phone: 1-800-SCAN2PDF</p>
              </div>
              <div class="col-md-4">
                <h5>Connect</h5>
                <a href="#"><i class="fab fa-facebook fa-2x text-light me-3"></i></a>
                <a href="#"><i class="fab fa-twitter fa-2x text-light me-3"></i></a>
                <a href="#"><i class="fab fa-linkedin fa-2x text-light me-3"></i></a>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col text-center">
                <p class="text-muted">&copy; 2023 Scan2 PDF+. All Rights Reserved.</p>
              </div>
            </div>
          </div>
        </footer>
        
      </div>

      <div id="loading-overlay" class="overlay">
        <div class="spinner"></div>
      </div>
</body>
<style>
  #wrapper {
        min-height: 100%;
        position: relative;
      }

      #content {
        padding-bottom: 60px; /* Height of the footer */
      }

      #footer {
        position: absolute;
        bottom: 0;
        width: 100%;
        height: 60px; /* Height of the footer */
      }
</style>
<!-- <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script> -->
<script>
function uploadFile(file, lang, request, limit) {
  var formData = new FormData();
  formData.append('file', file);
  formData.append('lang', lang);
  formData.append('request_type', request);
  formData.append('word_limit', limit);
  
  var xhr = new XMLHttpRequest();
  xhr.open('POST', '/upload', true);
  xhr.onreadystatechange = function() {
    loadingOverlay.style.display = 'none';
    uploadButton.disabled = false;
    if (xhr.readyState == 4 && xhr.status == 200) {  
      if(request == 'summary'){
        var response = xhr.responseText;
        var responseDiv = document.getElementById('response');
        var responseObj = JSON.parse(response);

        var format = responseObj.data.content
        format = format.replaceAll('\\u2019','');
        responseDiv.innerHTML = format;
      }else{
        if(xhr.responseText.includes("Error")){
          console.error(xhr.responseText);
          return;
        }
        // Assume that the compressed data is stored in an ArrayBuffer named compressedData
        // Convert the ArrayBuffer to a Uint8Array
        base64Data = xhr.response;
        const decompressedData = atob(base64Data);
        const uint8Array = new Uint8Array(decompressedData.length);
        for (let i = 0; i < decompressedData.length; i++) {
          uint8Array[i] = decompressedData.charCodeAt(i);
        }
        const blob = new Blob([uint8Array], { type: 'application/pdf; charset=utf-8;' });
        var downloadLink = document.createElement('a');
        var url = window.URL.createObjectURL(blob);
        downloadLink.href = url;
        downloadLink.download = 'Scan2PDF+.pdf';
        downloadLink.click();
        URL.revokeObjectURL(url);
      }
      console.log('File uploaded successfully');
    }else if(xhr.status == 505){
      console.warn("505 Internal Server Error.")
    }
  };
  xhr.send(formData);
}

var fileInput = document.getElementsByName('file')[0];
var loadingOverlay = document.getElementById('loading-overlay');

// var additionalDataInput = document.getElementById('additionalDataInput');
var uploadButton = document.getElementById('submit');
uploadButton.addEventListener('click', function() {
  var file = fileInput.files[0];
  var lang = document.getElementsByName('lang')[0].value;
  var request = document.getElementsByName('request_type')[0].value;
  var limit = document.getElementsByName('word_limit')[0].value;
  loadingOverlay.style.display = 'block';
  uploadButton.disabled = true;
  
  if(file && lang && request && limit){
    uploadFile(file, lang, request, limit);
  }else{
    console.error('All inputs are required!!!');
    loadingOverlay.style.display = 'none';
    uploadButton.disabled = false;
  }
});

</script>
</html>